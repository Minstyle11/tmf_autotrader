# NEW WINDOW OPENING PROMPT (FINAL, AUTO-UPDATED)

## Current status (Board head)

```text
# 專案進度總覽（自動計算）
- 更新時間：2026-02-08 21:54:15
- 專案總完成度：23.4% （已完成 25 / 107 項）

**專案總完成度 / Overall completion:** 23.4%（已完成 25 / 107 項；未完成 82 項）

<!-- AUTO:PROGRESS_BEGIN -->
- **TOTAL_TASKS:** 107
- **DONE_TASKS:** 25
- **PCT:** 23.4%
<!-- AUTO:PROGRESS_END -->

## 里程碑完成度
- M0 Foundations：100.0% （已完成 4 / 4）
- M1 Sim + Cost Model：100.0% （已完成 3 / 3）
- M2 Risk Engine v1 (Risk First)：100.0% （已完成 3 / 3）
- M3 Strategy Base + Paper Live：42.9% （已完成 3 / 7）

## 說明（快速讀法）
- 看「專案總完成度」掌握全局；看「里程碑完成度」掌握目前在哪一段。
- [ ] 進行中、[!] 阻塞、[x] 已完成。

# TMF AutoTrader Project Board (OFFICIAL)

## Status Legend
- [ ] TODO
- [~] DOING
- [x] DONE
- [!] BLOCKED



## Bible Linkage (OFFICIAL-LOCKED)

- Last refresh: 2026-02-06T08:18:13
```

## Latest changes (Changelog tail)

```text
- [2026-02-04 19:50:23] pm_tick
- [2026-02-04 19:55:23] pm_tick
- [2026-02-04 20:00:24] pm_tick
- [2026-02-04 20:05:24] pm_tick
- [2026-02-04 20:10:25] pm_tick
- [2026-02-04 20:15:25] pm_tick
- [2026-02-04 20:18:36] test_tick_no_board_touch
- [2026-02-04 20:20:25] pm_tick
- [2026-02-04 20:25:26] pm_tick
- [2026-02-04 20:30:26] pm_tick
- [2026-02-04 20:33:20] pm_refresh_board
- [2026-02-04 20:35:26] pm_tick
- [2026-02-04 20:40:27] pm_tick
- [2026-02-04 20:45:27] pm_tick
- [2026-02-04 20:50:28] pm_tick
```

## Working tree (git status --porcelain)

```text
A  "docs/_inbox/tmf_autotrader\345\260\210\346\241\210 - \346\206\262\346\263\225\347\264\232\350\246\217\347\257\204.rtf"
A  docs/bibles/TMF_AUTOTRADER_CONSTITUTION_BIBLE_v1.md
A  docs/bibles/TMF_AUTOTRADER_CONSTITUTION_BIBLE_v1.md.sha256.txt
M  docs/bibles/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18.md
M  docs/bibles/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18.md.sha256.txt
A  docs/bibles/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_1_PATCH.md
A  docs/bibles/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_1_PATCH.md.sha256.txt
A  docs/bibles/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_2_PATCH.md
A  docs/bibles/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_2_PATCH.md.sha256.txt
A  docs/bibles/patches/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_1_PATCH.md
A  docs/bibles/patches/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_1_PATCH.md.sha256.txt
A  docs/bibles/patches/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_2_PATCH.md
A  docs/bibles/patches/TMF_AutoTrader_BIBLE_OFFICIAL_LOCKED_v18_2_PATCH.md.sha256.txt
A  docs/board/BIBLES_INDEX_v18x.json
M  docs/board/CHANGELOG.md
MM docs/board/PROJECT_BOARD.md
MM docs/handoff/HANDOFF_LOG.md
MM docs/handoff/NEW_WINDOW_OPENING_PROMPT_DRAFT.md
MM docs/handoff/NEW_WINDOW_OPENING_PROMPT_FINAL.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_BIBLE_v1.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_BIBLE_v1.md.sha256.txt
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260204_120225.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260204_120225.md.sha256.txt
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260204_120731.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260204_120731.md.sha256.txt
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260204_161004.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260204_161004.md.sha256.txt
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260205_161002.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260205_161002.md.sha256.txt
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260206_161001.md
A  docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260206_161001.md.sha256.txt
A  docs/ops/HEALTH_CHECKS_KIND_AND_SMOKE_SUITE_BIBLE_v1.md
A  docs/ops/HEALTH_CHECKS_KIND_AND_SMOKE_SUITE_BIBLE_v1.md.sha256.txt
M  docs/ops/M2_REGRESSION_SUITE_BIBLE_v1.md
M  docs/ops/M2_REGRESSION_SUITE_BIBLE_v1.md.sha256.txt
AM docs/ops/OPS_INDEX.md
A  docs/ops/OPS_INDEX.md.sha256.txt
A  docs/ops/OPS_INDEX_OFFICIAL_SNAPSHOT_20260204_114806.md
A  docs/ops/OPS_INDEX_OFFICIAL_SNAPSHOT_20260204_114806.md.sha256.txt
A  docs/ops/OPS_SNAPSHOT_INDEXING_BIBLE_v1.md
A  docs/ops/OPS_SNAPSHOT_INDEXING_BIBLE_v1.md.sha256.txt
A  docs/ops/PM_LOGROTATE_CLOSEPACK_ALLOWLIST_OFFICIAL_SNAPSHOT_20260204_122807.md
A  docs/ops/PM_LOGROTATE_CLOSEPACK_ALLOWLIST_OFFICIAL_SNAPSHOT_20260204_122807.md.sha256.txt
A  docs/ops/PM_TICK_LOGROTATE_OFFICIAL_SNAPSHOT_20260204_110006.md
A  docs/ops/PM_TICK_LOGROTATE_OFFICIAL_SNAPSHOT_20260204_110006.md.sha256.txt
A  docs/ops/PM_TICK_LOGROTATE_RUNLOG_OFFICIAL_SNAPSHOT_20260204_112536.md
A  docs/ops/PM_TICK_LOGROTATE_RUNLOG_OFFICIAL_SNAPSHOT_20260204_112536.md.sha256.txt
AM docs/ops/PROJECT_BOARD_GOVERNANCE_BIBLE_v1.md
A  docs/ops/PROJECT_BOARD_GOVERNANCE_BIBLE_v1.md.sha256.txt
M  execution/reject_policy.yaml
A  execution/taifex_preflight_v1.py
M  m3_mainline_runner_v1.sh
MM runtime/handoff/state/latest_state.json
A  scripts/build_daily_finance_close_pack_v1.sh
 M scripts/gen_new_window_opening_prompt_ultra_zh.py
M  scripts/handoff_pack_on_demand_v1.sh
M  scripts/handoff_state_snapshot_v1.sh
M  scripts/m0_ops_autorestart_v1.sh
A  scripts/m2_regression_healthchecks_kind_v1.sh
M  scripts/m3_mainline_runner_v1.sh
A  scripts/m3_regression_paper_live_smoke_v1.sh
A  scripts/m3_regression_taifex_preflight_v1.sh
A  scripts/m3_regression_taifex_split_v1.sh
A  scripts/m6_update_project_board_v1.sh
A  scripts/m8_update_board_from_patches_v1.py
M  scripts/mk_windowpack_ultra.sh
A  scripts/oneshot_hardgate_verify_ultra.py
M  scripts/ops_audit_hardgate_v1.sh
A  scripts/ops_backup_repo_to_external_v1.sh
A  scripts/ops_seed_bidask_now_v1.py
M  scripts/paper_live_integration_smoke_v1.sh
A  scripts/pm_log_rotate_v1.sh
M  scripts/pm_refresh_board.sh
A  scripts/pm_refresh_board_v2.py
M  scripts/pm_tick.sh
A  scripts/run_daily_finance_close_pack_daily_v1.sh
AM scripts/run_paper_live_smoke_suite_v1.py
A  scripts/run_paper_live_v1.py
A  scripts/smoke_all_v1.sh
A  scripts/verify_pm_refresh_board_v1.sh
MM src/broker/shioaji_recorder.py
M  src/data/build_bars_1m_v1.py
M  src/data/store_sqlite_v1.py
M  src/market/market_metrics_from_db_v1.py
MM src/oms/paper_oms_risk_safety_wrapper_v1.py
M  src/oms/paper_oms_v1.py
MM src/oms/run_paper_live_v1.py
A  src/ops/board_mark_doing_v1.py
A  src/ops/require_bibles_v1.py
M  src/risk/risk_engine_v1.py
MM src/safety/system_safety_v1.py
AM src/sim/run_strategies_paper_loop_v1.py
AM src/sim/run_strategies_paper_v1.py
A  src/strat/__init__.py
AM src/strat/mean_reversion_v1.py
A  src/strat/strategy_base_v1.py
AM src/strat/trend_v1.py
?? docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260207_161204.md
?? docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260207_161204.md.sha256.txt
?? docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260208_161001.md
?? docs/ops/DAILY_FINANCE_CLOSE_PACK_OFFICIAL_SNAPSHOT_20260208_161001.md.sha256.txt
?? docs/ops/POWER_POLICY_STAGE_v1.md
?? docs/ops/POWER_POLICY_STAGE_v1.md.sha256.txt
?? scripts/m3_regression_paper_live_smoke_combo_v1.sh
?? scripts/m3_regression_spec_diff_stopper_v1.sh
?? scripts/m3_regression_suite_v1.sh
?? scripts/ops_seed_tick_now_v1.py
?? snapshots/m3/
?? src/execution/
?? src/tools/
```

## Next terminal step (runtime/handoff/state/next_step.txt)

```text
#!/bin/bash
set -euo pipefail
cd "$HOME/tmf_autotrader"

# NEXT (M3 Strategy Base + Paper Live): wire REAL market data -> DB -> MarketMetrics
# Updated: 2026-02-02 22:35:51
#
# Goal:
#  1) Add Shioaji futures quote subscription for TMF/TX/MTX (bid/ask levels) and persist to events.kind='bidask_fop_v1'
#     - Ensure payload has: code, bid_price[], ask_price[], bid_volume[], ask_volume[], source_file, ingest_ts, synthetic=False
#  2) Confirm SystemSafetyEngineV1 staleness guard sees latest NON-synthetic bidask in DB during market hours.
#  3) Confirm get_market_metrics_from_db returns non-empty market_metrics during market hours (ATR from bars_1m optional).
#  4) Keep TMF_DEV_ALLOW_STALE_BIDASK only for offline smoke; default remains strict.

# Step 1: locate current Shioaji quote recorder / event ingestor for futures (TMF/TX/MTX)
python3 - <<'PY2'
from pathlib import Path
import re

targets = []
for pat in ["shioaji", "quote", "bidask", "fop", "futures", "stream", "subscribe"]:
    pass

roots = [Path("src"), Path("scripts")]
for root in roots:
    if not root.exists(): 
        continue
    for f in root.rglob("*.py"):
        t = f.read_text(encoding="utf-8", errors="replace")
        if any(k in t.lower() for k in ["shioaji", "subscribe", "bidask", "quote"]):
            targets.append(str(f))

print("=== [CANDIDATES] files mentioning shioaji/quote/bidask ===")
for x in sorted(set(targets)):
    print(x)
print("=== [DONE] ===")
PY2
```

## Rules (must follow)
- One terminal command per turn.
- Append-only logs; no silent rewrites.
- One-click ZIP only when assistant signals capacity risk.
